const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BOR8qpuh.js","assets/vue-vendor-BsGWzACd.js","assets/math-vendor-C4rbpj_m.js","assets/markdown-vendor-BDlm1NQN.js","assets/index-DCljqfLO.css"])))=>i.map(i=>d[i]);
import{aB as J}from"./math-vendor-C4rbpj_m.js";import{u as j,r as V,m as L,j as q,d as Y,c as W,p as z,q as G,s as Q,a as F,b as r,t as p,e as a,g as X,F as O,f as T,x as Z,n as h,h as y,w as b,v as S,y as ee,l as te,o as K}from"./vue-vendor-BsGWzACd.js";import{c as ae,g as re}from"./index-BOR8qpuh.js";import{u as oe}from"./useCategories-C18qv1yq.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./markdown-vendor-BDlm1NQN.js";const le="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let B=(o=21)=>{let c="",g=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)c+=le[g[o]&63];return c};function N(o){const c=[];return o.title&&c.push(`title: ${k(o.title)}`),o.description&&c.push(`description: ${k(o.description)}`),o.categoryKey&&c.push(`categoryKey: ${k(o.categoryKey)}`),o.tag&&c.push(`tag: ${k(o.tag)}`),o.badge&&c.push(`badge: ${k(o.badge)}`),o.date&&c.push(`date: ${k(o.date)}`),o.platform&&c.push(`platform: ${k(o.platform)}`),o.cover&&c.push(`cover: ${k(o.cover)}`),(c.length>0?`---
${c.join(`
`)}
---

`:"")+(o.content||"").trim()}function k(o){return o.includes(":")||o.includes("#")||o.includes("|")||o.includes("&")||o.includes("*")||o.includes("!")||o.includes("%")||o.includes("@")||o.includes("`")||o.startsWith(" ")||o.endsWith(" ")||o.includes(`
`)?`"${o.replace(/"/g,'\\"')}"`:o}function R(o){const c=o.date||new Date().toISOString().split("T")[0],s=(o.title||"untitled").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();return`${c}-${s}`}const U=new Map;function $(o,c){try{const g=localStorage.getItem("article-file-handles")||"{}",s=JSON.parse(g);s[o]=c,localStorage.setItem("article-file-handles",JSON.stringify(s))}catch(g){console.error("Failed to save file handle:",g)}}function ie(o){try{const c=localStorage.getItem("article-file-handles");if(c)return JSON.parse(c)[o]||null}catch(c){console.error("Failed to get file handle name:",c)}return null}const ne=()=>{const o=q(),{messages:c,locale:g}=j(),s=V(!1),v=V(!1),i=(()=>{const u=c.value[g.value]?.categories||{},_=Object.keys(u).filter(w=>w!=="all");return _.length>0?_[0]:"c/c++"})(),e=L({title:"",description:"",content:"",categoryKey:i,tag:"",badge:"",date:new Date().toISOString().split("T")[0],platform:"Wechat",cover:"linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"}),E=()=>{e.title="",e.description="",e.content="",e.categoryKey=i,e.tag="",e.badge="",e.date=new Date().toISOString().split("T")[0],e.platform="Wechat",e.cover="linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"},x=n=>ae.some(u=>u.id===n),I=n=>{e.id=n.id,e.title=n.title,e.description=n.description,e.content=n.content,e.categoryKey=n.categoryKey,e.tag=n.tag,e.badge=n.badge,e.date=n.date,e.platform=n.platform,e.cover=n.cover},A=()=>{const n=[];return e.title?.trim()||n.push({field:"title",message:"title"}),e.description?.trim()||n.push({field:"description",message:"description"}),e.content?.trim()||n.push({field:"content",message:"content"}),e.categoryKey||n.push({field:"category",message:"category"}),e.tag?.trim()||n.push({field:"tag",message:"tag"}),e.date||n.push({field:"date",message:"date"}),e.platform?.trim()||n.push({field:"platform",message:"platform"}),e.cover?.trim()||n.push({field:"cover",message:"cover"}),n},C=async()=>A().length>0?null:{id:e.id||B(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};return{form:e,isSubmitting:s,isSavingFile:v,resetForm:E,loadArticle:I,validateForm:A,handleSubmit:C,handleSubmitAndRedirect:async()=>{const n=await C();n&&o.push({name:"articleDetail",params:{id:n.id}})},handlePublish:async()=>{if(A().length>0)return!1;if(!("showDirectoryPicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;v.value=!0;try{const u={id:e.id||B(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||i,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""},_=N(u),w=R(u)+".md",l=await(await window.showDirectoryPicker()).getFileHandle(w,{create:!0}),t=await l.createWritable();return await t.write(_),await t.close(),u.id&&(U.set(u.id,l),$(u.id,w)),!0}catch(u){return u.name!=="AbortError"&&(console.error("Failed to save file:",u),alert("保存文件失败："+(u.message||"未知错误"))),!1}finally{v.value=!1}},handleUpdate:async()=>{if(A().length>0||!e.id)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;v.value=!0;try{const u={id:e.id,title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||i,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""},_=N(u),w=R(u)+".md";let m=U.get(e.id);if(!m){const l=ie(e.id);try{m=(await window.showOpenFilePicker({types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}],multiple:!1}))[0],U.set(e.id,m),l?$(e.id,l):$(e.id,w)}catch(t){if(t.name!=="AbortError")throw t;return!1}}if(m){const l=await m.createWritable();await l.write(_),await l.close()}else throw new Error("无法获取文件句柄");return!0}catch(u){return u.name!=="AbortError"&&(console.error("Failed to update file:",u),alert("更新文件失败："+(u.message||"未知错误"))),!1}finally{v.value=!1}},isArticleFromContent:x}},ce={class:"layout edit-layout"},de={class:"hero"},ue={class:"edit-content"},fe={key:0,class:"validation-errors"},me={class:"error-header"},pe={class:"error-title"},ge={class:"error-list"},he={class:"form-section"},ve=["placeholder"],ye={class:"form-section"},be=["placeholder"],_e={class:"form-row"},we={class:"form-section"},Se=["value"],ke={class:"form-section"},Pe=["placeholder"],Fe={class:"form-row"},Ke={class:"form-section"},Ae={class:"form-section"},De=["placeholder"],Ee={class:"form-row"},Ie={class:"form-section"},Ce={class:"form-label"},Ve=["placeholder"],xe={class:"form-section"},Oe=["placeholder"],Te={class:"form-section"},Ue={class:"form-label"},$e={class:"cover-presets"},He=["onClick"],Me={class:"form-section"},We=["placeholder"],Be={class:"form-hint"},Ne={class:"form-actions"},Re=["disabled"],je=Y({__name:"ArticleEditPage",setup(o){const c=z(),g=q(),{t:s}=j(),v=W(()=>!!c.params.id),P=W(()=>{const m=c.params.id;return m||null}),{form:i,isSubmitting:e,isSavingFile:E,loadArticle:x,validateForm:I,resetForm:A,handlePublish:C,handleUpdate:H}=ne(),d=V([]),f=V(!1),{categories:n}=oe(!1),u=["linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)","linear-gradient(135deg, #0d121f 0%, #132642 50%, #243c5a 100%)","linear-gradient(135deg, #101820 0%, #1f1f2f 50%, #2c2c3b 100%)","linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)","linear-gradient(135deg, #2d1b69 0%, #11998e 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];G(()=>{if(v.value&&P.value){const m=re(P.value);m?x(m):g.push({name:"articles"})}else A()}),Q(()=>[i.title,i.description,i.content,i.categoryKey,i.tag,i.date,i.platform,i.cover],()=>{if(f.value&&d.value.length>0){const m=I();d.value=m,m.length===0&&(f.value=!1)}});const _=()=>{v.value&&P.value?g.push({name:"articleDetail",params:{id:P.value}}):g.push({name:"articles"})},w=async()=>{const m=I();if(m.length>0){d.value=m,f.value=!0,setTimeout(()=>{const l=document.querySelector(".form-error");l&&l.scrollIntoView({behavior:"smooth",block:"center"})},100);return}if(d.value=[],f.value=!1,v.value&&P.value){if(await H()){const{reloadArticles:t}=await J(async()=>{const{reloadArticles:D}=await import("./index-BOR8qpuh.js").then(M=>M.i);return{reloadArticles:D}},__vite__mapDeps([0,1,2,3,4]));await t(),g.push({name:"articleDetail",params:{id:P.value}})}}else await C()&&g.push({name:"articles"})};return(m,l)=>(K(),F("main",ce,[r("section",de,[r("h1",null,p(v.value?a(s)("article.editTitle"):a(s)("article.createTitle")),1),r("p",null,p(v.value?a(s)("article.editDesc"):a(s)("article.createDesc")),1)]),r("section",ue,[f.value&&d.value.length>0?(K(),F("div",fe,[r("div",me,[l[9]||(l[9]=r("span",{class:"error-icon"},"⚠️",-1)),r("span",pe,p(a(s)("article.validationError")),1)]),r("ul",ge,[(K(!0),F(O,null,T(d.value,(t,D)=>(K(),F("li",{key:D,class:"error-item"},p(a(s)(`article.${t.message}Required`)),1))),128))])])):X("",!0),r("form",{class:"article-form",onSubmit:Z(w,["prevent"])},[r("div",he,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="title")}])},[y(p(a(s)("article.title"))+" ",1),b(r("input",{"onUpdate:modelValue":l[0]||(l[0]=t=>a(i).title=t),type:"text",placeholder:a(s)("article.titlePlaceholder"),class:h({"form-error":f.value&&d.value.some(t=>t.field==="title")})},null,10,ve),[[S,a(i).title]])],2)]),r("div",ye,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="description")}])},[y(p(a(s)("article.description"))+" ",1),b(r("textarea",{"onUpdate:modelValue":l[1]||(l[1]=t=>a(i).description=t),rows:"3",placeholder:a(s)("article.descriptionPlaceholder"),class:h({"form-error":f.value&&d.value.some(t=>t.field==="description")})},null,10,be),[[S,a(i).description]])],2)]),r("div",_e,[r("div",we,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="category")}])},[y(p(a(s)("article.category"))+" ",1),b(r("select",{"onUpdate:modelValue":l[2]||(l[2]=t=>a(i).categoryKey=t),class:h({"form-error":f.value&&d.value.some(t=>t.field==="category")})},[(K(!0),F(O,null,T(a(n),t=>(K(),F("option",{key:t.key,value:t.key},p(t.label),9,Se))),128))],2),[[ee,a(i).categoryKey]])],2)]),r("div",ke,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="tag")}])},[y(p(a(s)("article.tag"))+" ",1),b(r("input",{"onUpdate:modelValue":l[3]||(l[3]=t=>a(i).tag=t),type:"text",placeholder:a(s)("article.tagPlaceholder"),class:h({"form-error":f.value&&d.value.some(t=>t.field==="tag")})},null,10,Pe),[[S,a(i).tag]])],2)])]),r("div",Fe,[r("div",Ke,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="date")}])},[y(p(a(s)("article.date"))+" ",1),b(r("input",{"onUpdate:modelValue":l[4]||(l[4]=t=>a(i).date=t),type:"date",class:h({"form-error":f.value&&d.value.some(t=>t.field==="date")})},null,2),[[S,a(i).date]])],2)]),r("div",Ae,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="platform")}])},[y(p(a(s)("article.platform"))+" ",1),b(r("input",{"onUpdate:modelValue":l[5]||(l[5]=t=>a(i).platform=t),type:"text",placeholder:a(s)("article.platformPlaceholder"),class:h({"form-error":f.value&&d.value.some(t=>t.field==="platform")})},null,10,De),[[S,a(i).platform]])],2)])]),r("div",Ee,[r("div",Ie,[r("label",Ce,[y(p(a(s)("article.badge"))+" ",1),b(r("input",{"onUpdate:modelValue":l[6]||(l[6]=t=>a(i).badge=t),type:"text",placeholder:a(s)("article.badgePlaceholder")},null,8,Ve),[[S,a(i).badge]])])]),r("div",xe,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="cover")}])},[y(p(a(s)("article.cover"))+" ",1),b(r("input",{"onUpdate:modelValue":l[7]||(l[7]=t=>a(i).cover=t),type:"text",placeholder:a(s)("article.coverPlaceholder"),class:h({"form-error":f.value&&d.value.some(t=>t.field==="cover")})},null,10,Oe),[[S,a(i).cover]])],2)])]),r("div",Te,[r("label",Ue,[y(p(a(s)("article.coverPresets"))+" ",1),r("div",$e,[(K(),F(O,null,T(u,(t,D)=>r("button",{key:D,type:"button",class:"cover-preset",style:te({background:t}),onClick:M=>a(i).cover=t},null,12,He)),64))])])]),r("div",Me,[r("label",{class:h(["form-label",{"has-error":f.value&&d.value.some(t=>t.field==="content")}])},[y(p(a(s)("article.content"))+" ",1),b(r("textarea",{"onUpdate:modelValue":l[8]||(l[8]=t=>a(i).content=t),rows:"20",placeholder:a(s)("article.contentPlaceholder"),class:h(["content-textarea",{"form-error":f.value&&d.value.some(t=>t.field==="content")}])},null,10,We),[[S,a(i).content]])],2),r("p",Be,p(a(s)("article.contentHint")),1)]),r("div",Ne,[r("button",{type:"button",class:"cancel-btn",onClick:_},p(a(s)("article.cancel")),1),r("button",{type:"submit",class:"submit-btn",disabled:a(e)||a(E)},p(a(E)?a(s)("article.saving"):a(e)?a(s)("article.saving"):v.value?a(s)("article.update"):a(s)("article.publish")),9,Re)])],32)])]))}}),Qe=se(je,[["__scopeId","data-v-cbfd1f6e"]]);export{Qe as default};
