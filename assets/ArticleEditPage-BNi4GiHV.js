const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cof0n7GT.js","assets/vue-vendor-kiT1BP1D.js","assets/math-vendor-C4rbpj_m.js","assets/markdown-vendor-BDlm1NQN.js","assets/index-DCljqfLO.css"])))=>i.map(i=>d[i]);
import{aB as te}from"./math-vendor-C4rbpj_m.js";import{u as Z,r as V,q as ae,m as ee,d as re,c as N,s as oe,o as se,x as Y,a as S,b as r,t as g,e as a,j as B,F as L,h as j,y as le,g as v,l as b,w as k,v as E,z as ie,f as ne,i as F}from"./vue-vendor-kiT1BP1D.js";import{c as ce,g as de,b as ue}from"./index-Cof0n7GT.js";import{u as fe}from"./useCategories-C2sffmD1.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./markdown-vendor-BDlm1NQN.js";const pe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let G=(o=21)=>{let u="",m=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)u+=pe[m[o]&63];return u};function Q(o,u){const m=[];return o.title&&m.push(`title: ${I(o.title)}`),o.description&&m.push(`description: ${I(o.description)}`),o.categoryKey&&m.push(`categoryKey: ${I(o.categoryKey)}`),o.tag&&m.push(`tag: ${I(o.tag)}`),o.badge&&m.push(`badge: ${I(o.badge)}`),o.date&&m.push(`date: ${I(o.date)}`),o.platform&&m.push(`platform: ${I(o.platform)}`),o.cover&&m.push(`cover: ${I(o.cover)}`),u&&m.push(`filename: ${I(u)}`),(m.length>0?`---
${m.join(`
`)}
---

`:"")+(o.content||"").trim()}function I(o){return o.includes(":")||o.includes("#")||o.includes("|")||o.includes("&")||o.includes("*")||o.includes("!")||o.includes("%")||o.includes("@")||o.includes("`")||o.startsWith(" ")||o.endsWith(" ")||o.includes(`
`)?`"${o.replace(/"/g,'\\"')}"`:o}function q(o){const u=o.date||new Date().toISOString().split("T")[0],_=(o.title||"untitled").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();return`${u}-${_}`}const z=new Map;function U(o,u){try{const m=localStorage.getItem("article-file-handles")||"{}",_=JSON.parse(m);_[o]=u,localStorage.setItem("article-file-handles",JSON.stringify(_))}catch(m){console.error("Failed to save file handle:",m)}}function X(o){try{const u=localStorage.getItem("article-file-handles");if(u)return JSON.parse(u)[o]||null}catch(u){console.error("Failed to get file handle name:",u)}return null}const ge=()=>{const o=ee(),{messages:u,locale:m}=Z(),_=V(!1),K=V(!1),W=(()=>{const p=u.value[m.value]?.categories||{},h=Object.keys(p).filter(i=>i!=="all");return h.length>0?h[0]:"c/c++"})(),e=ae({title:"",description:"",content:"",categoryKey:W,tag:"",badge:"",date:new Date().toISOString().split("T")[0],platform:"Wechat",cover:"linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"}),l=()=>{e.title="",e.description="",e.content="",e.categoryKey=W,e.tag="",e.badge="",e.date=new Date().toISOString().split("T")[0],e.platform="Wechat",e.cover="linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"},P=c=>ce.some(p=>p.id===c),x=c=>{e.id=c.id,e.title=c.title,e.description=c.description,e.content=c.content,e.categoryKey=c.categoryKey,e.tag=c.tag,e.badge=c.badge,e.date=c.date,e.platform=c.platform,e.cover=c.cover},s=()=>{const c=[];return e.title?.trim()||c.push({field:"title",message:"title"}),e.description?.trim()||c.push({field:"description",message:"description"}),e.content?.trim()||c.push({field:"content",message:"content"}),e.categoryKey||c.push({field:"category",message:"category"}),e.tag?.trim()||c.push({field:"tag",message:"tag"}),e.date||c.push({field:"date",message:"date"}),e.platform?.trim()||c.push({field:"platform",message:"platform"}),e.cover?.trim()||c.push({field:"cover",message:"cover"}),c},$=async()=>s().length>0?null:{id:e.id||G(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};return{form:e,isSubmitting:_,isSavingFile:K,resetForm:l,loadArticle:x,validateForm:s,handleSubmit:$,handleSubmitAndRedirect:async()=>{const c=await $();c&&o.push({name:"articleDetail",params:{id:c.id}})},handlePublish:async()=>{if(s().length>0)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;K.value=!0;try{const p={id:e.id||G(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||W,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};let h=q(p)+".md";if(e.filename?.trim()){let D=e.filename.trim();D.endsWith(".md")||(D=D+".md"),h=D}const i=await window.showSaveFilePicker({suggestedName:h,types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}]}),f=i.name,y=Q(p,f),A=await i.createWritable();await A.write(y),await A.close();const C=de(f);return z.set(C,i),U(C,f),!0}catch(p){return p.name!=="AbortError"&&(console.error("Failed to save file:",p),alert("保存文件失败："+(p.message||"未知错误"))),!1}finally{K.value=!1}},handleUpdate:async()=>{if(s().length>0||!e.id)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;K.value=!0;try{const p={id:e.id,title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||W,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};let h=z.get(e.id),i;if(h){const y=X(e.id);y?i=y:(i=q(p)+".md",U(e.id,i))}else{const y=X(e.id);try{if(h=(await window.showOpenFilePicker({types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}],multiple:!1}))[0],i=h.name,z.set(e.id,h),y)U(e.id,y);else{const C=q(p)+".md";U(e.id,C),i=C}}catch(A){if(A.name!=="AbortError")throw A;return!1}}const f=Q(p,i);if(h){const y=await h.createWritable();await y.write(f),await y.close(),U(e.id,i)}else throw new Error("无法获取文件句柄");return!0}catch(p){return p.name!=="AbortError"&&(console.error("Failed to update file:",p),alert("更新文件失败："+(p.message||"未知错误"))),!1}finally{K.value=!1}},isArticleFromContent:P}},ve={class:"layout edit-layout"},he={class:"hero"},ye={class:"edit-content"},be={key:0,class:"validation-errors"},_e={class:"error-header"},we={class:"error-title"},Se={class:"error-list"},ke={class:"form-section"},Fe=["placeholder"],Ie={class:"form-section"},Pe=["placeholder"],Ae={class:"form-row"},Ee={class:"form-section"},Ke=["value"],We={class:"form-section"},xe=["placeholder"],Ce={class:"form-row"},De={class:"form-section"},Ve={class:"form-section"},$e=["placeholder"],Ue={class:"form-row"},Oe={class:"form-section"},Te={class:"form-label"},Me=["placeholder"],Re={class:"form-section"},He={class:"cover-input-group"},Ne=["placeholder"],Be={class:"cover-actions"},Le={key:0,class:"cover-preview"},je=["src"],qe={class:"form-section"},ze={class:"form-label"},Je={class:"cover-presets"},Ye=["onClick"],Ge={class:"form-section"},Qe=["placeholder"],Xe={class:"form-hint"},Ze={class:"form-actions"},et=["disabled"],tt=re({__name:"ArticleEditPage",setup(o){const u=V(null),m=V(),_=n=>{const t=n.target.files?.[0];if(t){if(!t.type.startsWith("image/")){alert(l("article.coverImageError"));return}if(t.size>5*1024*1024){alert(l("article.coverImageSizeError"));return}const w=new FileReader;w.onload=T=>{const H=T.target?.result;H&&(u.value=H,s.cover=H)},w.onerror=()=>{alert(l("article.coverImageError"))},w.readAsDataURL(t)}},K=()=>{u.value=null,m.value&&(m.value.value=""),s.cover=""},O=N(()=>{if(u.value)return u.value;if(s.cover){const n=s.cover.trim();if(n.startsWith("http://")||n.startsWith("https://")||n.startsWith("data:image/"))return n}return null}),W=oe(),e=ee(),{t:l}=Z(),P=N(()=>!!W.params.id),x=N(()=>{const n=W.params.id;return n||null}),{form:s,isSubmitting:$,isSavingFile:M,loadArticle:J,validateForm:R,resetForm:c,handlePublish:p,handleUpdate:h}=ge(),i=V([]),f=V(!1),{categories:y}=fe(!1),A=["linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)","linear-gradient(135deg, #0d121f 0%, #132642 50%, #243c5a 100%)","linear-gradient(135deg, #101820 0%, #1f1f2f 50%, #2c2c3b 100%)","linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)","linear-gradient(135deg, #2d1b69 0%, #11998e 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];se(()=>{if(P.value&&x.value){const n=ue(x.value);n?(J(n),n.cover&&(n.cover.startsWith("http://")||n.cover.startsWith("https://")||n.cover.startsWith("data:image/"))&&(u.value=n.cover)):e.push({name:"articles"})}else c()}),Y(()=>[s.title,s.description,s.content,s.categoryKey,s.tag,s.date,s.platform,s.cover],()=>{if(f.value&&i.value.length>0){const n=R();i.value=n,n.length===0&&(f.value=!1)}}),Y(()=>s.cover,n=>{n&&(n.startsWith("http://")||n.startsWith("https://")||n.startsWith("data:image/"))?(!u.value||u.value!==n)&&(u.value=n):n||(u.value=null)});const C=()=>{P.value&&x.value?e.push({name:"articleDetail",params:{id:x.value}}):e.push({name:"articles"})},D=async()=>{const n=R();if(n.length>0){i.value=n,f.value=!0,setTimeout(()=>{const d=document.querySelector(".form-error");d&&d.scrollIntoView({behavior:"smooth",block:"center"})},100);return}if(i.value=[],f.value=!1,P.value&&x.value){if(await h()){const{reloadArticles:t}=await te(async()=>{const{reloadArticles:w}=await import("./index-Cof0n7GT.js").then(T=>T.i);return{reloadArticles:w}},__vite__mapDeps([0,1,2,3,4]));await t(),e.push({name:"articles"})}}else await p()&&e.push({name:"articles"})};return(n,d)=>(F(),S("main",ve,[r("section",he,[r("h1",null,g(P.value?a(l)("article.editTitle"):a(l)("article.createTitle")),1),r("p",null,g(P.value?a(l)("article.editDesc"):a(l)("article.createDesc")),1)]),r("section",ye,[f.value&&i.value.length>0?(F(),S("div",be,[r("div",_e,[d[11]||(d[11]=r("span",{class:"error-icon"},"⚠️",-1)),r("span",we,g(a(l)("article.validationError")),1)]),r("ul",Se,[(F(!0),S(L,null,j(i.value,(t,w)=>(F(),S("li",{key:w,class:"error-item"},g(a(l)(`article.${t.message}Required`)),1))),128))])])):B("",!0),r("form",{class:"article-form",onSubmit:le(D,["prevent"])},[r("div",ke,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="title")}])},[b(g(a(l)("article.title"))+" ",1),k(r("input",{"onUpdate:modelValue":d[0]||(d[0]=t=>a(s).title=t),type:"text",placeholder:a(l)("article.titlePlaceholder"),class:v({"form-error":f.value&&i.value.some(t=>t.field==="title")})},null,10,Fe),[[E,a(s).title]])],2)]),r("div",Ie,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="description")}])},[b(g(a(l)("article.description"))+" ",1),k(r("textarea",{"onUpdate:modelValue":d[1]||(d[1]=t=>a(s).description=t),rows:"3",placeholder:a(l)("article.descriptionPlaceholder"),class:v({"form-error":f.value&&i.value.some(t=>t.field==="description")})},null,10,Pe),[[E,a(s).description]])],2)]),r("div",Ae,[r("div",Ee,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="category")}])},[b(g(a(l)("article.category"))+" ",1),k(r("select",{"onUpdate:modelValue":d[2]||(d[2]=t=>a(s).categoryKey=t),class:v({"form-error":f.value&&i.value.some(t=>t.field==="category")})},[(F(!0),S(L,null,j(a(y),t=>(F(),S("option",{key:t.key,value:t.key},g(t.label),9,Ke))),128))],2),[[ie,a(s).categoryKey]])],2)]),r("div",We,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="tag")}])},[b(g(a(l)("article.tag"))+" ",1),k(r("input",{"onUpdate:modelValue":d[3]||(d[3]=t=>a(s).tag=t),type:"text",placeholder:a(l)("article.tagPlaceholder"),class:v({"form-error":f.value&&i.value.some(t=>t.field==="tag")})},null,10,xe),[[E,a(s).tag]])],2)])]),r("div",Ce,[r("div",De,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="date")}])},[b(g(a(l)("article.date"))+" ",1),k(r("input",{"onUpdate:modelValue":d[4]||(d[4]=t=>a(s).date=t),type:"date",class:v({"form-error":f.value&&i.value.some(t=>t.field==="date")})},null,2),[[E,a(s).date]])],2)]),r("div",Ve,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="platform")}])},[b(g(a(l)("article.platform"))+" ",1),k(r("input",{"onUpdate:modelValue":d[5]||(d[5]=t=>a(s).platform=t),type:"text",placeholder:a(l)("article.platformPlaceholder"),class:v({"form-error":f.value&&i.value.some(t=>t.field==="platform")})},null,10,$e),[[E,a(s).platform]])],2)])]),r("div",Ue,[r("div",Oe,[r("label",Te,[b(g(a(l)("article.badge"))+" ",1),k(r("input",{"onUpdate:modelValue":d[6]||(d[6]=t=>a(s).badge=t),type:"text",placeholder:a(l)("article.badgePlaceholder")},null,8,Me),[[E,a(s).badge]])])]),r("div",Re,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="cover")}])},[b(g(a(l)("article.cover"))+" ",1),r("div",He,[k(r("input",{"onUpdate:modelValue":d[7]||(d[7]=t=>a(s).cover=t),type:"text",placeholder:a(l)("article.coverPlaceholder"),class:v({"form-error":f.value&&i.value.some(t=>t.field==="cover")})},null,10,Ne),[[E,a(s).cover]]),r("div",Be,[r("button",{type:"button",class:"cover-upload-btn",onClick:d[8]||(d[8]=t=>m.value?.click())},g(a(l)("article.uploadImage")),1),r("input",{ref_key:"coverFileInput",ref:m,type:"file",accept:"image/*",style:{display:"none"},onChange:_},null,544),O.value?(F(),S("button",{key:0,type:"button",class:"cover-clear-btn",onClick:K},g(a(l)("article.clearImage")),1)):B("",!0)])]),O.value?(F(),S("div",Le,[r("img",{src:O.value,alt:"Cover preview",onError:d[9]||(d[9]=t=>u.value=null)},null,40,je)])):B("",!0)],2)])]),r("div",qe,[r("label",ze,[b(g(a(l)("article.coverPresets"))+" ",1),r("div",Je,[(F(),S(L,null,j(A,(t,w)=>r("button",{key:w,type:"button",class:"cover-preset",style:ne({background:t}),onClick:T=>a(s).cover=t},null,12,Ye)),64))])])]),r("div",Ge,[r("label",{class:v(["form-label",{"has-error":f.value&&i.value.some(t=>t.field==="content")}])},[b(g(a(l)("article.content"))+" ",1),k(r("textarea",{"onUpdate:modelValue":d[10]||(d[10]=t=>a(s).content=t),rows:"20",placeholder:a(l)("article.contentPlaceholder"),class:v(["content-textarea",{"form-error":f.value&&i.value.some(t=>t.field==="content")}])},null,10,Qe),[[E,a(s).content]])],2),r("p",Xe,g(a(l)("article.contentHint")),1)]),r("div",Ze,[r("button",{type:"button",class:"cancel-btn",onClick:C},g(a(l)("article.cancel")),1),r("button",{type:"submit",class:"submit-btn",disabled:a($)||a(M)},g(a(M)?a(l)("article.saving"):a($)?a(l)("article.saving"):P.value?a(l)("article.update"):a(l)("article.publish")),9,et)])],32)])]))}}),nt=me(tt,[["__scopeId","data-v-84960d4d"]]);export{nt as default};
