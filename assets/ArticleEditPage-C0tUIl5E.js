const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BLlvGBm8.js","assets/vue-vendor-D3XWct0c.js","assets/math-vendor-mDk7booa.js","assets/markdown-vendor-BDlm1NQN.js","assets/index-H6fgQ93f.css"])))=>i.map(i=>d[i]);
import{aB as ae}from"./math-vendor-mDk7booa.js";import{u as ee,r as C,x as re,q as te,d as oe,c as N,y as se,o as le,w as Y,a as k,b as r,t as p,e as a,j as B,F as L,h as j,z as ie,g,p as b,l as D,v as E,A as ne,f as ce,i as F}from"./vue-vendor-D3XWct0c.js";import{c as de,v as G,g as ue}from"./index-BLlvGBm8.js";import{u as fe}from"./useCategories-BYgl4rKb.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./markdown-vendor-BDlm1NQN.js";const pe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Q=(o=21)=>{let s="",v=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)s+=pe[v[o]&63];return s};function X(o){const s=[];return o.title&&s.push(`title: ${_(o.title)}`),o.description&&s.push(`description: ${_(o.description)}`),o.categoryKey&&s.push(`categoryKey: ${_(o.categoryKey)}`),o.tag&&s.push(`tag: ${_(o.tag)}`),o.badge&&s.push(`badge: ${_(o.badge)}`),o.date&&s.push(`date: ${_(o.date)}`),o.updatedDate&&s.push(`updatedDate: ${_(o.updatedDate)}`),o.platform&&s.push(`platform: ${_(o.platform)}`),o.cover&&s.push(`cover: ${_(o.cover)}`),o.id&&s.push(`articleId: ${_(o.id)}`),(s.length>0?`---
${s.join(`
`)}
---

`:"")+(o.content||"").trim()}function _(o){return o.includes(":")||o.includes("#")||o.includes("|")||o.includes("&")||o.includes("*")||o.includes("!")||o.includes("%")||o.includes("@")||o.includes("`")||o.startsWith(" ")||o.endsWith(" ")||o.includes(`
`)?`"${o.replace(/"/g,'\\"')}"`:o}function q(o){const s=o.date||new Date().toISOString().split("T")[0],I=(o.title||"untitled").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();return`${s}-${I}`}const z=new Map;function O(o,s){try{const v=localStorage.getItem("article-file-handles")||"{}",I=JSON.parse(v);I[o]=s,localStorage.setItem("article-file-handles",JSON.stringify(I))}catch(v){console.error("Failed to save file handle:",v)}}function Z(o){try{const s=localStorage.getItem("article-file-handles");if(s)return JSON.parse(s)[o]||null}catch(s){console.error("Failed to get file handle name:",s)}return null}const ge=()=>{const o=te(),{messages:s,locale:v}=ee(),I=C(!1),K=C(!1),W=(()=>{const m=s.value[v.value]?.categories||{},h=Object.keys(m).filter(n=>n!=="all");return h.length>0?h[0]:"c/c++"})(),e=re({title:"",description:"",content:"",categoryKey:W,tag:"",badge:"",date:new Date().toISOString().split("T")[0],updatedDate:void 0,platform:"Wechat",cover:"linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"}),i=()=>{e.title="",e.description="",e.content="",e.categoryKey=W,e.tag="",e.badge="",e.date=new Date().toISOString().split("T")[0],e.updatedDate=void 0,e.platform="Wechat",e.cover="linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"},P=c=>de.some(m=>m.id===c),$=c=>{e.id=c.id,e.title=c.title,e.description=c.description,e.content=c.content,e.categoryKey=c.categoryKey,e.tag=c.tag,e.badge=c.badge,e.date=c.date,e.updatedDate=c.updatedDate,e.platform=c.platform,e.cover=c.cover},l=()=>{const c=[];return e.title?.trim()||c.push({field:"title",message:"title"}),e.description?.trim()||c.push({field:"description",message:"description"}),e.content?.trim()||c.push({field:"content",message:"content"}),e.categoryKey||c.push({field:"category",message:"category"}),e.tag?.trim()||c.push({field:"tag",message:"tag"}),e.date||c.push({field:"date",message:"date"}),e.platform?.trim()||c.push({field:"platform",message:"platform"}),e.cover?.trim()||c.push({field:"cover",message:"cover"}),c},V=async()=>l().length>0?null:{id:e.id||Q(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],updatedDate:e.updatedDate,platform:e.platform||"Wechat",cover:e.cover||""};return{form:e,isSubmitting:I,isSavingFile:K,resetForm:i,loadArticle:$,validateForm:l,handleSubmit:V,handleSubmitAndRedirect:async()=>{const c=await V();c&&o.push({name:"articleDetail",params:{id:c.id}})},handlePublish:async()=>{if(l().length>0)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;K.value=!0;try{const m={id:e.id||Q(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||W,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],updatedDate:e.updatedDate,platform:e.platform||"Wechat",cover:e.cover||""};let h=q(m)+".md";if(e.filename?.trim()){let w=e.filename.trim();w.endsWith(".md")||(w=w+".md"),h=w}const n=await window.showSaveFilePicker({suggestedName:h,types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}]}),u=n.name,x=m.id||G();m.id=x;const y=X(m),A=await n.createWritable();return await A.write(y),await A.close(),z.set(x,n),O(x,u),!0}catch(m){return m.name!=="AbortError"&&(console.error("Failed to save file:",m),alert("保存文件失败："+(m.message||"未知错误"))),!1}finally{K.value=!1}},handleUpdate:async()=>{if(l().length>0||!e.id)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;K.value=!0;try{const m=new Date().toISOString().split("T")[0],h={id:e.id,title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||W,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],updatedDate:m,platform:e.platform||"Wechat",cover:e.cover||""};let n=z.get(e.id),u;if(n){const y=Z(e.id);y?u=y:(u=q(h)+".md",O(e.id,u))}else{const y=Z(e.id);try{if(n=(await window.showOpenFilePicker({types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}],multiple:!1}))[0],u=n.name,z.set(e.id,n),y)O(e.id,y);else{const w=q(h)+".md";O(e.id,w),u=w}}catch(A){if(A.name!=="AbortError")throw A;return!1}}h.id||(h.id=G());const x=X(h);if(n){const y=await n.createWritable();await y.write(x),await y.close(),O(h.id,u)}else throw new Error("无法获取文件句柄");return!0}catch(m){return m.name!=="AbortError"&&(console.error("Failed to update file:",m),alert("更新文件失败："+(m.message||"未知错误"))),!1}finally{K.value=!1}},isArticleFromContent:P}},ve={class:"layout edit-layout"},he={class:"hero"},ye={class:"edit-content"},be={key:0,class:"validation-errors"},_e={class:"error-header"},we={class:"error-title"},Se={class:"error-list"},ke={class:"form-section"},De=["placeholder"],Fe={class:"form-section"},Ie=["placeholder"],Pe={class:"form-row"},Ae={class:"form-section"},Ee=["value"],Ke={class:"form-section"},We=["placeholder"],$e={class:"form-row"},xe={class:"form-section"},Ce={class:"form-section"},Ve=["placeholder"],Oe={class:"form-row"},Te={class:"form-section"},Ue={class:"form-label"},Me=["placeholder"],Re={class:"form-section"},He={class:"cover-input-group"},Ne=["placeholder"],Be={class:"cover-actions"},Le={key:0,class:"cover-preview"},je=["src"],qe={class:"form-section"},ze={class:"form-label"},Je={class:"cover-presets"},Ye=["onClick"],Ge={class:"form-section"},Qe=["placeholder"],Xe={class:"form-hint"},Ze={class:"form-actions"},et=["disabled"],tt=oe({__name:"ArticleEditPage",setup(o){const s=C(null),v=C(),I=d=>{const t=d.target.files?.[0];if(t){if(!t.type.startsWith("image/")){alert(i("article.coverImageError"));return}if(t.size>5*1024*1024){alert(i("article.coverImageSizeError"));return}const S=new FileReader;S.onload=U=>{const H=U.target?.result;H&&(s.value=H,l.cover=H)},S.onerror=()=>{alert(i("article.coverImageError"))},S.readAsDataURL(t)}},K=()=>{s.value=null,v.value&&(v.value.value=""),l.cover=""},T=N(()=>{if(s.value)return s.value;if(l.cover){const d=l.cover.trim();if(d.startsWith("http://")||d.startsWith("https://")||d.startsWith("data:image/"))return d}return null}),W=se(),e=te(),{t:i}=ee(),P=N(()=>!!W.params.id),$=N(()=>{const d=W.params.id;return d||null}),{form:l,isSubmitting:V,isSavingFile:M,loadArticle:J,validateForm:R,resetForm:c,handlePublish:m,handleUpdate:h}=ge(),n=C([]),u=C(!1),{categories:x}=fe(!1),y=["linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)","linear-gradient(135deg, #0d121f 0%, #132642 50%, #243c5a 100%)","linear-gradient(135deg, #101820 0%, #1f1f2f 50%, #2c2c3b 100%)","linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)","linear-gradient(135deg, #2d1b69 0%, #11998e 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];le(()=>{if(P.value&&$.value){const d=ue($.value);d?(J(d),d.cover&&(d.cover.startsWith("http://")||d.cover.startsWith("https://")||d.cover.startsWith("data:image/"))&&(s.value=d.cover)):e.push({name:"articles"})}else c()}),Y(()=>[l.title,l.description,l.content,l.categoryKey,l.tag,l.date,l.platform,l.cover],()=>{if(u.value&&n.value.length>0){const d=R();n.value=d,d.length===0&&(u.value=!1)}}),Y(()=>l.cover,d=>{d&&(d.startsWith("http://")||d.startsWith("https://")||d.startsWith("data:image/"))?(!s.value||s.value!==d)&&(s.value=d):d||(s.value=null)});const A=()=>{P.value&&$.value?e.push({name:"articleDetail",params:{id:$.value}}):e.push({name:"articles"})},w=async()=>{const d=R();if(d.length>0){n.value=d,u.value=!0,setTimeout(()=>{const f=document.querySelector(".form-error");f&&f.scrollIntoView({behavior:"smooth",block:"center"})},100);return}if(n.value=[],u.value=!1,P.value&&$.value){if(await h()){const{reloadArticles:t}=await ae(async()=>{const{reloadArticles:S}=await import("./index-BLlvGBm8.js").then(U=>U.b);return{reloadArticles:S}},__vite__mapDeps([0,1,2,3,4]));await t(),e.push({name:"articles"})}}else await m()&&e.push({name:"articles"})};return(d,f)=>(F(),k("main",ve,[r("section",he,[r("h1",null,p(P.value?a(i)("article.editTitle"):a(i)("article.createTitle")),1),r("p",null,p(P.value?a(i)("article.editDesc"):a(i)("article.createDesc")),1)]),r("section",ye,[u.value&&n.value.length>0?(F(),k("div",be,[r("div",_e,[f[11]||(f[11]=r("span",{class:"error-icon"},"⚠️",-1)),r("span",we,p(a(i)("article.validationError")),1)]),r("ul",Se,[(F(!0),k(L,null,j(n.value,(t,S)=>(F(),k("li",{key:S,class:"error-item"},p(a(i)(`article.${t.message}Required`)),1))),128))])])):B("",!0),r("form",{class:"article-form",onSubmit:ie(w,["prevent"])},[r("div",ke,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="title")}])},[b(p(a(i)("article.title"))+" ",1),D(r("input",{"onUpdate:modelValue":f[0]||(f[0]=t=>a(l).title=t),type:"text",placeholder:a(i)("article.titlePlaceholder"),class:g({"form-error":u.value&&n.value.some(t=>t.field==="title")})},null,10,De),[[E,a(l).title]])],2)]),r("div",Fe,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="description")}])},[b(p(a(i)("article.description"))+" ",1),D(r("textarea",{"onUpdate:modelValue":f[1]||(f[1]=t=>a(l).description=t),rows:"3",placeholder:a(i)("article.descriptionPlaceholder"),class:g({"form-error":u.value&&n.value.some(t=>t.field==="description")})},null,10,Ie),[[E,a(l).description]])],2)]),r("div",Pe,[r("div",Ae,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="category")}])},[b(p(a(i)("article.category"))+" ",1),D(r("select",{"onUpdate:modelValue":f[2]||(f[2]=t=>a(l).categoryKey=t),class:g({"form-error":u.value&&n.value.some(t=>t.field==="category")})},[(F(!0),k(L,null,j(a(x),t=>(F(),k("option",{key:t.key,value:t.key},p(t.label),9,Ee))),128))],2),[[ne,a(l).categoryKey]])],2)]),r("div",Ke,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="tag")}])},[b(p(a(i)("article.tag"))+" ",1),D(r("input",{"onUpdate:modelValue":f[3]||(f[3]=t=>a(l).tag=t),type:"text",placeholder:a(i)("article.tagPlaceholder"),class:g({"form-error":u.value&&n.value.some(t=>t.field==="tag")})},null,10,We),[[E,a(l).tag]])],2)])]),r("div",$e,[r("div",xe,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="date")}])},[b(p(a(i)("article.date"))+" ",1),D(r("input",{"onUpdate:modelValue":f[4]||(f[4]=t=>a(l).date=t),type:"date",class:g({"form-error":u.value&&n.value.some(t=>t.field==="date")})},null,2),[[E,a(l).date]])],2)]),r("div",Ce,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="platform")}])},[b(p(a(i)("article.platform"))+" ",1),D(r("input",{"onUpdate:modelValue":f[5]||(f[5]=t=>a(l).platform=t),type:"text",placeholder:a(i)("article.platformPlaceholder"),class:g({"form-error":u.value&&n.value.some(t=>t.field==="platform")})},null,10,Ve),[[E,a(l).platform]])],2)])]),r("div",Oe,[r("div",Te,[r("label",Ue,[b(p(a(i)("article.badge"))+" ",1),D(r("input",{"onUpdate:modelValue":f[6]||(f[6]=t=>a(l).badge=t),type:"text",placeholder:a(i)("article.badgePlaceholder")},null,8,Me),[[E,a(l).badge]])])]),r("div",Re,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="cover")}])},[b(p(a(i)("article.cover"))+" ",1),r("div",He,[D(r("input",{"onUpdate:modelValue":f[7]||(f[7]=t=>a(l).cover=t),type:"text",placeholder:a(i)("article.coverPlaceholder"),class:g({"form-error":u.value&&n.value.some(t=>t.field==="cover")})},null,10,Ne),[[E,a(l).cover]]),r("div",Be,[r("button",{type:"button",class:"cover-upload-btn",onClick:f[8]||(f[8]=t=>v.value?.click())},p(a(i)("article.uploadImage")),1),r("input",{ref_key:"coverFileInput",ref:v,type:"file",accept:"image/*",style:{display:"none"},onChange:I},null,544),T.value?(F(),k("button",{key:0,type:"button",class:"cover-clear-btn",onClick:K},p(a(i)("article.clearImage")),1)):B("",!0)])]),T.value?(F(),k("div",Le,[r("img",{src:T.value,alt:"Cover preview",onError:f[9]||(f[9]=t=>s.value=null)},null,40,je)])):B("",!0)],2)])]),r("div",qe,[r("label",ze,[b(p(a(i)("article.coverPresets"))+" ",1),r("div",Je,[(F(),k(L,null,j(y,(t,S)=>r("button",{key:S,type:"button",class:"cover-preset",style:ce({background:t}),onClick:U=>a(l).cover=t},null,12,Ye)),64))])])]),r("div",Ge,[r("label",{class:g(["form-label",{"has-error":u.value&&n.value.some(t=>t.field==="content")}])},[b(p(a(i)("article.content"))+" ",1),D(r("textarea",{"onUpdate:modelValue":f[10]||(f[10]=t=>a(l).content=t),rows:"20",placeholder:a(i)("article.contentPlaceholder"),class:g(["content-textarea",{"form-error":u.value&&n.value.some(t=>t.field==="content")}])},null,10,Qe),[[E,a(l).content]])],2),r("p",Xe,p(a(i)("article.contentHint")),1)]),r("div",Ze,[r("button",{type:"button",class:"cancel-btn",onClick:A},p(a(i)("article.cancel")),1),r("button",{type:"submit",class:"submit-btn",disabled:a(V)||a(M)},p(a(M)?a(i)("article.saving"):a(V)?a(i)("article.saving"):P.value?a(i)("article.update"):a(i)("article.publish")),9,et)])],32)])]))}}),nt=me(tt,[["__scopeId","data-v-84960d4d"]]);export{nt as default};
