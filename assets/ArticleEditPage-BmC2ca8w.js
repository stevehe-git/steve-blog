const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BHQOpO3A.js","assets/vue-vendor-D3XWct0c.js","assets/math-vendor-HGAuMS-A.js","assets/markdown-vendor-BDlm1NQN.js","assets/index-H6fgQ93f.css"])))=>i.map(i=>d[i]);
import{aB as ae}from"./math-vendor-HGAuMS-A.js";import{u as ee,r as V,x as re,q as te,d as oe,c as N,y as se,o as le,w as Y,a as w,b as r,t as p,e as a,j as B,F as L,h as j,z as ie,g,p as b,l as S,v as A,A as ne,f as ce,i as k}from"./vue-vendor-D3XWct0c.js";import{c as de,v as G,g as ue}from"./index-BHQOpO3A.js";import{u as fe}from"./useCategories-BYgl4rKb.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./markdown-vendor-BDlm1NQN.js";const pe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Q=(o=21)=>{let s="",v=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)s+=pe[v[o]&63];return s};function X(o){const s=[];return o.title&&s.push(`title: ${F(o.title)}`),o.description&&s.push(`description: ${F(o.description)}`),o.categoryKey&&s.push(`categoryKey: ${F(o.categoryKey)}`),o.tag&&s.push(`tag: ${F(o.tag)}`),o.badge&&s.push(`badge: ${F(o.badge)}`),o.date&&s.push(`date: ${F(o.date)}`),o.platform&&s.push(`platform: ${F(o.platform)}`),o.cover&&s.push(`cover: ${F(o.cover)}`),o.id&&s.push(`articleId: ${F(o.id)}`),(s.length>0?`---
${s.join(`
`)}
---

`:"")+(o.content||"").trim()}function F(o){return o.includes(":")||o.includes("#")||o.includes("|")||o.includes("&")||o.includes("*")||o.includes("!")||o.includes("%")||o.includes("@")||o.includes("`")||o.startsWith(" ")||o.endsWith(" ")||o.includes(`
`)?`"${o.replace(/"/g,'\\"')}"`:o}function q(o){const s=o.date||new Date().toISOString().split("T")[0],I=(o.title||"untitled").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();return`${s}-${I}`}const z=new Map;function U(o,s){try{const v=localStorage.getItem("article-file-handles")||"{}",I=JSON.parse(v);I[o]=s,localStorage.setItem("article-file-handles",JSON.stringify(I))}catch(v){console.error("Failed to save file handle:",v)}}function Z(o){try{const s=localStorage.getItem("article-file-handles");if(s)return JSON.parse(s)[o]||null}catch(s){console.error("Failed to get file handle name:",s)}return null}const ge=()=>{const o=te(),{messages:s,locale:v}=ee(),I=V(!1),E=V(!1),K=(()=>{const f=s.value[v.value]?.categories||{},h=Object.keys(f).filter(n=>n!=="all");return h.length>0?h[0]:"c/c++"})(),e=re({title:"",description:"",content:"",categoryKey:K,tag:"",badge:"",date:new Date().toISOString().split("T")[0],platform:"Wechat",cover:"linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"}),i=()=>{e.title="",e.description="",e.content="",e.categoryKey=K,e.tag="",e.badge="",e.date=new Date().toISOString().split("T")[0],e.platform="Wechat",e.cover="linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"},P=d=>de.some(f=>f.id===d),W=d=>{e.id=d.id,e.title=d.title,e.description=d.description,e.content=d.content,e.categoryKey=d.categoryKey,e.tag=d.tag,e.badge=d.badge,e.date=d.date,e.platform=d.platform,e.cover=d.cover},l=()=>{const d=[];return e.title?.trim()||d.push({field:"title",message:"title"}),e.description?.trim()||d.push({field:"description",message:"description"}),e.content?.trim()||d.push({field:"content",message:"content"}),e.categoryKey||d.push({field:"category",message:"category"}),e.tag?.trim()||d.push({field:"tag",message:"tag"}),e.date||d.push({field:"date",message:"date"}),e.platform?.trim()||d.push({field:"platform",message:"platform"}),e.cover?.trim()||d.push({field:"cover",message:"cover"}),d},$=async()=>l().length>0?null:{id:e.id||Q(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};return{form:e,isSubmitting:I,isSavingFile:E,resetForm:i,loadArticle:W,validateForm:l,handleSubmit:$,handleSubmitAndRedirect:async()=>{const d=await $();d&&o.push({name:"articleDetail",params:{id:d.id}})},handlePublish:async()=>{if(l().length>0)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;E.value=!0;try{const f={id:e.id||Q(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||K,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};let h=q(f)+".md";if(e.filename?.trim()){let D=e.filename.trim();D.endsWith(".md")||(D=D+".md"),h=D}const n=await window.showSaveFilePicker({suggestedName:h,types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}]}),m=n.name,y=f.id||G();f.id=y;const x=X(f),C=await n.createWritable();return await C.write(x),await C.close(),z.set(y,n),U(y,m),!0}catch(f){return f.name!=="AbortError"&&(console.error("Failed to save file:",f),alert("保存文件失败："+(f.message||"未知错误"))),!1}finally{E.value=!1}},handleUpdate:async()=>{if(l().length>0||!e.id)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;E.value=!0;try{const f={id:e.id,title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||K,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};let h=z.get(e.id),n;if(h){const y=Z(e.id);y?n=y:(n=q(f)+".md",U(e.id,n))}else{const y=Z(e.id);try{if(h=(await window.showOpenFilePicker({types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}],multiple:!1}))[0],n=h.name,z.set(e.id,h),y)U(e.id,y);else{const C=q(f)+".md";U(e.id,C),n=C}}catch(x){if(x.name!=="AbortError")throw x;return!1}}f.id||(f.id=G());const m=X(f);if(h){const y=await h.createWritable();await y.write(m),await y.close(),U(f.id,n)}else throw new Error("无法获取文件句柄");return!0}catch(f){return f.name!=="AbortError"&&(console.error("Failed to update file:",f),alert("更新文件失败："+(f.message||"未知错误"))),!1}finally{E.value=!1}},isArticleFromContent:P}},ve={class:"layout edit-layout"},he={class:"hero"},ye={class:"edit-content"},be={key:0,class:"validation-errors"},_e={class:"error-header"},we={class:"error-title"},Se={class:"error-list"},ke={class:"form-section"},Fe=["placeholder"],Ie={class:"form-section"},Pe=["placeholder"],Ae={class:"form-row"},Ee={class:"form-section"},Ke=["value"],We={class:"form-section"},xe=["placeholder"],Ce={class:"form-row"},De={class:"form-section"},Ve={class:"form-section"},$e=["placeholder"],Ue={class:"form-row"},Oe={class:"form-section"},Te={class:"form-label"},Me=["placeholder"],Re={class:"form-section"},He={class:"cover-input-group"},Ne=["placeholder"],Be={class:"cover-actions"},Le={key:0,class:"cover-preview"},je=["src"],qe={class:"form-section"},ze={class:"form-label"},Je={class:"cover-presets"},Ye=["onClick"],Ge={class:"form-section"},Qe=["placeholder"],Xe={class:"form-hint"},Ze={class:"form-actions"},et=["disabled"],tt=oe({__name:"ArticleEditPage",setup(o){const s=V(null),v=V(),I=c=>{const t=c.target.files?.[0];if(t){if(!t.type.startsWith("image/")){alert(i("article.coverImageError"));return}if(t.size>5*1024*1024){alert(i("article.coverImageSizeError"));return}const _=new FileReader;_.onload=T=>{const H=T.target?.result;H&&(s.value=H,l.cover=H)},_.onerror=()=>{alert(i("article.coverImageError"))},_.readAsDataURL(t)}},E=()=>{s.value=null,v.value&&(v.value.value=""),l.cover=""},O=N(()=>{if(s.value)return s.value;if(l.cover){const c=l.cover.trim();if(c.startsWith("http://")||c.startsWith("https://")||c.startsWith("data:image/"))return c}return null}),K=se(),e=te(),{t:i}=ee(),P=N(()=>!!K.params.id),W=N(()=>{const c=K.params.id;return c||null}),{form:l,isSubmitting:$,isSavingFile:M,loadArticle:J,validateForm:R,resetForm:d,handlePublish:f,handleUpdate:h}=ge(),n=V([]),m=V(!1),{categories:y}=fe(!1),x=["linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)","linear-gradient(135deg, #0d121f 0%, #132642 50%, #243c5a 100%)","linear-gradient(135deg, #101820 0%, #1f1f2f 50%, #2c2c3b 100%)","linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)","linear-gradient(135deg, #2d1b69 0%, #11998e 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];le(()=>{if(P.value&&W.value){const c=ue(W.value);c?(J(c),c.cover&&(c.cover.startsWith("http://")||c.cover.startsWith("https://")||c.cover.startsWith("data:image/"))&&(s.value=c.cover)):e.push({name:"articles"})}else d()}),Y(()=>[l.title,l.description,l.content,l.categoryKey,l.tag,l.date,l.platform,l.cover],()=>{if(m.value&&n.value.length>0){const c=R();n.value=c,c.length===0&&(m.value=!1)}}),Y(()=>l.cover,c=>{c&&(c.startsWith("http://")||c.startsWith("https://")||c.startsWith("data:image/"))?(!s.value||s.value!==c)&&(s.value=c):c||(s.value=null)});const C=()=>{P.value&&W.value?e.push({name:"articleDetail",params:{id:W.value}}):e.push({name:"articles"})},D=async()=>{const c=R();if(c.length>0){n.value=c,m.value=!0,setTimeout(()=>{const u=document.querySelector(".form-error");u&&u.scrollIntoView({behavior:"smooth",block:"center"})},100);return}if(n.value=[],m.value=!1,P.value&&W.value){if(await h()){const{reloadArticles:t}=await ae(async()=>{const{reloadArticles:_}=await import("./index-BHQOpO3A.js").then(T=>T.b);return{reloadArticles:_}},__vite__mapDeps([0,1,2,3,4]));await t(),e.push({name:"articles"})}}else await f()&&e.push({name:"articles"})};return(c,u)=>(k(),w("main",ve,[r("section",he,[r("h1",null,p(P.value?a(i)("article.editTitle"):a(i)("article.createTitle")),1),r("p",null,p(P.value?a(i)("article.editDesc"):a(i)("article.createDesc")),1)]),r("section",ye,[m.value&&n.value.length>0?(k(),w("div",be,[r("div",_e,[u[11]||(u[11]=r("span",{class:"error-icon"},"⚠️",-1)),r("span",we,p(a(i)("article.validationError")),1)]),r("ul",Se,[(k(!0),w(L,null,j(n.value,(t,_)=>(k(),w("li",{key:_,class:"error-item"},p(a(i)(`article.${t.message}Required`)),1))),128))])])):B("",!0),r("form",{class:"article-form",onSubmit:ie(D,["prevent"])},[r("div",ke,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="title")}])},[b(p(a(i)("article.title"))+" ",1),S(r("input",{"onUpdate:modelValue":u[0]||(u[0]=t=>a(l).title=t),type:"text",placeholder:a(i)("article.titlePlaceholder"),class:g({"form-error":m.value&&n.value.some(t=>t.field==="title")})},null,10,Fe),[[A,a(l).title]])],2)]),r("div",Ie,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="description")}])},[b(p(a(i)("article.description"))+" ",1),S(r("textarea",{"onUpdate:modelValue":u[1]||(u[1]=t=>a(l).description=t),rows:"3",placeholder:a(i)("article.descriptionPlaceholder"),class:g({"form-error":m.value&&n.value.some(t=>t.field==="description")})},null,10,Pe),[[A,a(l).description]])],2)]),r("div",Ae,[r("div",Ee,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="category")}])},[b(p(a(i)("article.category"))+" ",1),S(r("select",{"onUpdate:modelValue":u[2]||(u[2]=t=>a(l).categoryKey=t),class:g({"form-error":m.value&&n.value.some(t=>t.field==="category")})},[(k(!0),w(L,null,j(a(y),t=>(k(),w("option",{key:t.key,value:t.key},p(t.label),9,Ke))),128))],2),[[ne,a(l).categoryKey]])],2)]),r("div",We,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="tag")}])},[b(p(a(i)("article.tag"))+" ",1),S(r("input",{"onUpdate:modelValue":u[3]||(u[3]=t=>a(l).tag=t),type:"text",placeholder:a(i)("article.tagPlaceholder"),class:g({"form-error":m.value&&n.value.some(t=>t.field==="tag")})},null,10,xe),[[A,a(l).tag]])],2)])]),r("div",Ce,[r("div",De,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="date")}])},[b(p(a(i)("article.date"))+" ",1),S(r("input",{"onUpdate:modelValue":u[4]||(u[4]=t=>a(l).date=t),type:"date",class:g({"form-error":m.value&&n.value.some(t=>t.field==="date")})},null,2),[[A,a(l).date]])],2)]),r("div",Ve,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="platform")}])},[b(p(a(i)("article.platform"))+" ",1),S(r("input",{"onUpdate:modelValue":u[5]||(u[5]=t=>a(l).platform=t),type:"text",placeholder:a(i)("article.platformPlaceholder"),class:g({"form-error":m.value&&n.value.some(t=>t.field==="platform")})},null,10,$e),[[A,a(l).platform]])],2)])]),r("div",Ue,[r("div",Oe,[r("label",Te,[b(p(a(i)("article.badge"))+" ",1),S(r("input",{"onUpdate:modelValue":u[6]||(u[6]=t=>a(l).badge=t),type:"text",placeholder:a(i)("article.badgePlaceholder")},null,8,Me),[[A,a(l).badge]])])]),r("div",Re,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="cover")}])},[b(p(a(i)("article.cover"))+" ",1),r("div",He,[S(r("input",{"onUpdate:modelValue":u[7]||(u[7]=t=>a(l).cover=t),type:"text",placeholder:a(i)("article.coverPlaceholder"),class:g({"form-error":m.value&&n.value.some(t=>t.field==="cover")})},null,10,Ne),[[A,a(l).cover]]),r("div",Be,[r("button",{type:"button",class:"cover-upload-btn",onClick:u[8]||(u[8]=t=>v.value?.click())},p(a(i)("article.uploadImage")),1),r("input",{ref_key:"coverFileInput",ref:v,type:"file",accept:"image/*",style:{display:"none"},onChange:I},null,544),O.value?(k(),w("button",{key:0,type:"button",class:"cover-clear-btn",onClick:E},p(a(i)("article.clearImage")),1)):B("",!0)])]),O.value?(k(),w("div",Le,[r("img",{src:O.value,alt:"Cover preview",onError:u[9]||(u[9]=t=>s.value=null)},null,40,je)])):B("",!0)],2)])]),r("div",qe,[r("label",ze,[b(p(a(i)("article.coverPresets"))+" ",1),r("div",Je,[(k(),w(L,null,j(x,(t,_)=>r("button",{key:_,type:"button",class:"cover-preset",style:ce({background:t}),onClick:T=>a(l).cover=t},null,12,Ye)),64))])])]),r("div",Ge,[r("label",{class:g(["form-label",{"has-error":m.value&&n.value.some(t=>t.field==="content")}])},[b(p(a(i)("article.content"))+" ",1),S(r("textarea",{"onUpdate:modelValue":u[10]||(u[10]=t=>a(l).content=t),rows:"20",placeholder:a(i)("article.contentPlaceholder"),class:g(["content-textarea",{"form-error":m.value&&n.value.some(t=>t.field==="content")}])},null,10,Qe),[[A,a(l).content]])],2),r("p",Xe,p(a(i)("article.contentHint")),1)]),r("div",Ze,[r("button",{type:"button",class:"cancel-btn",onClick:C},p(a(i)("article.cancel")),1),r("button",{type:"submit",class:"submit-btn",disabled:a($)||a(M)},p(a(M)?a(i)("article.saving"):a($)?a(i)("article.saving"):P.value?a(i)("article.update"):a(i)("article.publish")),9,et)])],32)])]))}}),nt=me(tt,[["__scopeId","data-v-84960d4d"]]);export{nt as default};
