---
title: swap增加内存
description: swap增加内存
categoryKey: linux
tag: swap调整
badge: linux
date: 2025-12-27
platform: Wechat
cover: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
---

# 本机环境
```
steve@steve:~$ free -h
              total        used        free      shared  buff/cache   available
Mem:           15Gi       4.4Gi       4.5Gi       905Mi       6.6Gi       9.9Gi
Swap:         7.4Gi          0B       7.4Gi
steve@steve:~$ swapon --show
NAME           TYPE      SIZE USED PRIO
/dev/nvme0n1p2 partition 7.5G   0B   -2
steve@steve:~$ 
```
有时候运行大模型或者训练的时候，运行16GB内存往往不够用，这个时候需要 扩大swap内存，不然电脑会比较卡

# 扩容方案
## 推荐方案：保留原 swap 分区 + 新增一个 swap 文件（安全、简单、无需重分区）
这样总 swap = 7.5G（分区） + 8.5G（文件） ≈ 16G
```
# 1. 创建 8.5GB 的 swap 文件（16 - 7.5 ≈ 8.5）
sudo fallocate -l 8.5G /swapfile

# 如果 fallocate 报错（某些文件系统不支持），改用 dd：
# sudo dd if=/dev/zero of=/swapfile bs=1M count=8704  # 8704 = 8.5 * 1024

# 2. 设置安全权限
sudo chmod 600 /swapfile

# 3. 格式化为 swap
sudo mkswap /swapfile

# 4. 启用它
sudo swapon /swapfile

# 5. 验证
free -h
swapon --show
```

## 可选：完全用 swap 文件替代分区（更干净）
如果你愿意放弃 swap 分区：
```
# 1. 关闭现有 swap
sudo swapoff /dev/nvme0n1p2

# 2. 创建 16GB swap 文件
sudo fallocate -l 16G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# 3. 从 /etc/fstab 中注释或删除原来的 swap 分区行
sudo nano /etc/fstab
# 找到类似 /dev/nvme0n1p2 ... swap ... 的行，加 # 注释掉

# 4. （可选）将原 swap 分区格式化为普通分区或留空
```